<!DOCTYPE html>
<html>
<!-- based on a Pen by Devilish Alchemist @ http://codepen.io/devilishalchemist/pen/LERvpM -->
<head>
  <meta charset="UTF-8">
  <title>R3. Les cartes des écarts</title>

  <link rel="stylesheet" href="../../../_resources/css/normalize.min.css">
  <link rel="stylesheet" href="../../../_resources/css/whhg.css">
  <link rel="stylesheet" href="../../../_resources/css/fonts.css">
  <link rel="stylesheet" href="../../../_resources/css/style.css">

</head>

<body>
  <div class="page">

    <span id="view-toc" class="tooltip">&laquo; view index</span>
    <span id="view-content" class="tooltip">return to content &raquo;</span>
    <span id="view-next" class="tooltip">next page &raquo;</span>
    <span id="view-prev" class="tooltip">&laquo; previous page</span>

    <span class="menu_toggle">
      <i class="menu_open icon icon-th-list"></i>
      <i class="menu_close icon icon-import"></i>
    </span>

    <div id="navigation">
      <ul>
<li><a href="../../../Home.html" title="Home" class="page">Home</a>
<ul>
<li><a href="../../1._Acquisition.html" title="1. Acquisition" class="page">1. Acquisition</a></li>
<li><a href="../../2._Créer_les_modèles_3D.html" title="2. Créer les modèles 3D" class="page">2. Créer les modèles 3D</a></li>
<li><a href="../../3._PETrA.html" title="3. PETrA" class="page">3. PETrA</a>
<ul>
<li><a href="../1._Configurer_le_fichier_Blender.html" title="1. Configurer le fichier Blender" class="page">1. Configurer le fichier Blender</a></li>
<li><a href="../2._Produire_les_différentes_couches_d_information.html" title="2. Produire les différentes couches d information" class="page">2. Produire les différentes couches d information</a>
<ul>
<li><a href="./C1._La_Couleur.html" title="C1. La Couleur" class="page">C1. La Couleur</a></li>
<li><a href="./L1._L_illumination_globale.html" title="L1. L illumination globale" class="page">L1. L illumination globale</a></li>
<li><a href="./R1._Les_ombrages.html" title="R1. Les ombrages" class="page">R1. Les ombrages</a></li>
<li><a href="./R2._Les_courbes_de_niveau.html" title="R2. Les courbes de niveau" class="page">R2. Les courbes de niveau</a></li>
<li><b>R3. Les cartes des écarts</b></li>
<li><a href="./R4._Pointosité.html" title="R4. Pointosité" class="page">R4. Pointosité</a></li>
<li><a href="./zH._Détails.html" title="zH. Détails" class="page">zH. Détails</a></li>
<li><a href="./zH._Esquisser_les_contours.html" title="zH. Esquisser les contours" class="page">zH. Esquisser les contours</a></li>
<li><a href="./zH._Habillage_de_la_vue.html" title="zH. Habillage de la vue" class="page">zH. Habillage de la vue</a></li>
</ul>
</li>
<li><a href="../3._Cas_particuliers.html" title="3. Cas particuliers" class="page">3. Cas particuliers</a></li>
</ul>
</li>
<li><a href="../../4._ICEO.html" title="4. ICEO" class="page">4. ICEO</a></li>
<li><a href="../../5._Mettre_en_page_la_description_géométrale.html" title="5. Mettre en page la description géométrale" class="page">5. Mettre en page la description géométrale</a></li>
<li><a href="../../6._Logiciels.html" title="6. Logiciels" class="page">6. Logiciels</a></li>
<li><a href="../../7._Gestion_de_la_documentation.html" title="7. Gestion de la documentation" class="page">7. Gestion de la documentation</a></li>
</ul></li>
</ul>

      <span class="zimversion">
        <small>built with</small><br><strong>Zim 0.72.0</strong>
        <br>
        --
        <br>
        <a href="https://github.com/scar45/ResponsivePivot">template<br> on Github<br><i class="icon icon-github"></i></a>
      </span>
    </div>

    <main class="content">
      <div class="content_inner">
        <article>
          <header>
            <a id="navPrev" href='./R2._Les_courbes_de_niveau.html'><span><i class="icon icon-chevron-left"></i></span></a>

            <a id="navHome" href='../../../Home.html'><span><i class="icon icon-homealt"></i></span></a>

            <a id="navNext" href='./R4._Pointosité.html'><span><i class="icon icon-chevron-right"></i></span></a>
          </header>

          <section>
            <div class="page-title">
              <h1><i class="icon icon-bookmarkalt"></i> R3. Les cartes des écarts <a name='Home:3. PETrA:2. Produire les différentes couches d information:R3. Les cartes des écarts'></a></h1>
            </div>
            <div class="fade fade-top"></div>
            <div class="page-body">
              <h2>Définition</h2>

<p>
Les cartes des écarts sont le résultat d'une comparaison entre une représentation détaillée et simplifiée de la surface. <br>
En fonction du degré de simplification du maillage, plus ou moins d'information peuvent ressortir. Deux niveaux d'information sont systématiquement générés :<br>
<ul>
<li>EC1 : pour mettre en évidence des détails techniques de réalisation (comme les impacts de percussion)</li>
<li>EC2 : pour mettre en évidence une composition plus globale — ce niveau d'information permet de faire le relevé des gravures</li>
</ul>
</p>

<h2>Préparation des données</h2>

<br>

<h3>Préparation des maillages de comparaison</h3>

<p>
Dans <b>Meshlab</b>,<br>
<ol type="1" start="1">
<li>Pour produire EC1 :
<ol type="a" start="1">
<li>Ouvrir le maillage au format *.ply</li>
<li>Chercher la fonction `Simplification : Quadric Edge Mesh Decimation"</li>
<li>Percentage reduction (0..1) = 0.25</li>
<li>Chercher la fonction `Laplacian Smooth`</li>
<li>Smoothing Steps = 3 ; Apply ; Close</li>
<li>Enregistrer le maillage sous le nom `[Nom du fichier initial]_EC1.ply`</li>
</ol>
</li>
<li>Pour produire EC2 : répéter exactement les étapes de <b>b</b> à <b>d</b>
<ol type="a" start="1">
<li>Enregistrer le maillage sous le nom `[Nom du fichier initial]_EC2.ply`</li>
</ol></li>
</ol>
</p>

<p>
Illustration de l'étape 1b :<br>
<img src="./quadric.png" width="607">
</p>

<p>
Illustration de l'étape 1d :<br>
<img src="./laplacian.png" width="607">
</p>

<h3>Calcul des écarts</h3>

<p>
Dans <b>CloudCompare</b>, <br>
<ol type="1" start="1">
<li>Importer les fichiers <b>nuage de points</b> et les maillages EC1 et EC2 :
<ol type="a" start="1">
<li>`6_C_[Nom du fichier]_5dmm.ply`</li>
<li>`6_M_[Nom du fichier]_EC1.ply`</li>
<li>`6_M_[Nom du fichier]_EC2.ply`</li>
</ol>
</li>
<li>Premier passage
<ol type="a" start="1">
<li>Calculer la distance entre EC1 et le nuage de points</li>
<li>Appliquer le dégradé en niveau de gris</li>
<li>Régler les extrema en fonction de la répartiion des valeurs sur l'histogramme (en général : -2mm ; +2mm)</li>
<li>Convertir le scalar field en RGB</li>
<li>Création d'un maillage (algorithme Poisson ; Résolution : 1mm)</li>
<li>Enregistrer le maillage sous le nom `6_M_[Nom du fichier]_EC1-2mm.ply`</li>
</ol>
</li>
<li>Second passage
<ol type="a" start="1">
<li>Calculer la distance entre EC2 et le nuage de points</li>
<li>Appliquer le dégradé en niveau de gris</li>
<li>Régler les extrema en fonction de la répartiion des valeurs sur l'histogramme (en général : -6mm ; +6mm)</li>
<li>Convertir le scalar field en RGB</li>
<li>Création d'un maillage (algorithme Poisson ; Résolution : 1mm)</li>
<li>Enregistrer le maillage sous le nom `6_M_[Nom du fichier]_EC2-6mm.ply`</li>
</ol></li>
</ol>
</p>

<h3>Optimisation des maillages</h3>

<p>
Si le modèle 3D est généré dans CloudCompare pour avoir une résolution de 1mm, il se trouve que le maillage est légèrement plus dense... Pour augmenter la rapidité des traitements à venir, il est judicieux de l'optimiser.
</p>

<p>
Dans <b>Meshlab</b>,<br>
<ol type="1" start="1">
<li>Ouvrir les maillages
<ol type="a" start="1">
<li>`6_M_[Nom du fichier]_EC1-2mm.ply`</li>
<li>`6_M_[Nom du fichier]_EC2-6mm.ply`</li>
</ol>
</li>
<li>Chercher la fonction `Merge Close Vertices`</li>
<li>Dans la case `World Unit`, indiquer `0.001`</li>
<li>Appliquer</li>
<li>Enregistrer les maillages sous leur même nom</li>
</ol>
</p>

<p>
<b>Exemple de gain suite à l'opération :</b><br>
<ul style='padding-left: 30pt'>
<li><u>Avant		 | Après		 | Réduction (%)</u></li>
<li><u>... 			| ...			| ...</u></li>
</ul>
</p>

<h2>Mise en oeuvre</h2>

<p>
<ol type="1" start="1">
<li>Supprimer ou désactiver le rendu du maillage déjà présent dans la scène</li>
</ol>
</p>

<p>
<ol type="1" start="3">
<li>Importer le maillage `<b>..._EC1-#mm.ply</b>`
<ol type="a" start="1">
<li><b>Onglet 1 :</b> Masquer la sphère témoin.</li>
<li><b>Onglet 2 :</b> Appliquer le matériau `R3_EC`.</li>
<li><b>Onglet 3 :</b> Connecter `Ouput 1` avec `R3_EC`. Casser toute autre liaison que celle-ci.</li>
<li><b>Onglet 3 :</b> Vérifier que chacun des noeuds terminaux soient connectés sur la puce `...EC1-...` et remplacer la valeur `#mm` en accord avec le maillage importé</li>
<li><b>Onglet 3 :</b> Sélectionner le moteur de rendu EEVEE.</li>
<li><b>Onglet 3 :</b> Render all cameras.</li>
</ol></li>
</ol>
</p>

<p>
<ol type="1" start="3">
<li>Importer le maillage `<b>..._EC2-#mm.ply</b>`
<ol type="a" start="1">
<li><b>Onglet 2 :</b> Appliquer le matériau `R3_EC`.</li>
<li><b>Onglet 3 :</b> Connecter `Ouput 1` avec `R3_EC`. Casser toute autre liaison que celle-ci.</li>
<li><b>Onglet 3 :</b> Vérifier que chacun des noeuds terminaux soient connectés sur la puce `...EC1-...` et remplacer la valeur `#mm` en accord avec le maillage importé</li>
<li><b>Onglet 3 :</b> Sélectionner le moteur de rendu EEVEE.</li>
<li><b>Onglet 3 :</b> Render all cameras.</li>
</ol></li>
</ol>
</p>

<p>
Les images sont alors enregistrées dans le dossier à la racine du projet nommé `TEMP`.
</p>

<p>
<b>Note :</b> En général, les valeurs utilisées sont :<br>
<ul>
<li>EC1-2mm / EC2-6mm</li>
<li>EC1-15dmm / EC2-[il n'y a pas de règle]</li>
</ul>
</p>

<h2>Liste des images produites et leurs caractéristiques</h2>

<p>
<b>Structure du nom des fichiers générés :</b><br>
<div style='padding-left: 30pt'>
[Nom de la caméra]_[Catégorie d'information]_[Identifiant de l'information générée]-[Valeurs extrêmes du dégradé, normalement centré sur 0].png<br>
[Nom complet du fichier décliné]_[Nom du dégradé].jpg
</div>
</p>

<p>
<b>Liste des fichiers :</b><br>
<ul>
<li>Cam-##_R3_EC1-#mm.png</li>
<li>Cam-##_R3_EC1-#mm_BBR.jpg</li>
<li>Cam-##_R3_EC1-#mm_BVJR.jpg</li>
<li>Cam-##_R3_EC1-#mm_Magma.jpg</li>
<li>Cam-##_R3_EC1-#mm_Spectral.jpg</li>
<li>Cam-##_R3_EC1-#mm_Viridis.jpg</li>
</ul>
</p>

<p>
<ul>
<li>Cam-##_R3_EC2-#mm.png</li>
<li>Cam-##_R3_EC2-#mm_BBR.jpg</li>
<li>Cam-##_R3_EC2-#mm_BVJR.jpg</li>
<li>Cam-##_R3_EC2-#mm_Magma.jpg</li>
<li>Cam-##_R3_EC2-#mm_Spectral.jpg</li>
<li>Cam-##_R3_EC2-#mm_Viridis.jpg</li>
</ul>
</p>

<p>
Les différents dégradés générés automatiquement (avec les extrema les plus couramment utilisés) :
</p>

<p>
<img src="./degrades.png" width="500">
</p>

<h2>Description du matériau (onglet 2)</h2>

<p>
<img src="./R3.png" width="608">
</p>

<h2>Description du compositeur (onglet 3)</h2>

<p>
Les noeuds sont facilement explorables à travers l'interface Blender.
</p>

<h2>Pistes de recherche</h2>

<p>
Il existe un plugin pour Blender qui permet de calculer la distance entre deux maillages. Il n'y aurait donc plus de manipulation intermédiaire dans Meshlab et CloudCompare.<br>
<a href="https://blendermarket.com/products/distance-map/docs" title="https://blendermarket.com/products/distance-map/docs" class="https">https://blendermarket.com/products/distance-map/docs</a>
</p>

<h3>Utilisation du plugin Distance Map</h3>

<p>
<ol type="1" start="1">
<li>Sélectionner le maillage simplifier, puis le maillage HD (avec ctrl)</li>
<li>Paramétrage de l'extension :</li>
</ol>
<ul>
<li>Raycast mode : Normals</li>
<li>Normalization Value : 0.00</li>
</ul>
</p>

<p>
<ol type="1" start="3">
<li>Sahding, description du matériau : </li>
</ol>
<ul>
<li>On a une boîte "vertex color"</li>
<li>Un "ColorRamp" (curseur noir placé à 0.5 / curseur blanc à 1). A remplacer le premier "ColorRamp" par "Map Range" pour contrôler les valeurs extrêmes?</li>
<li>Un "colorRamp" pour appliquer le dégradé de couleur souhaité</li>
<li>un Shader "Emission"</li>
<li>"Material Output"</li>
</ul>
</p>

            </div>
            <div class="fade fade-bottom"></div>
          </section>

          <footer>
              <a href="#" class="scrollToTop" title="Back to top"><i class="icon icon-uploadalt"></i></a>
          </footer>
        </article>
      </div>
    </main>
  </div>

  <script src="../../../_resources/js/jquery.v2.1.3.min.js"></script>
  <script src="../../../_resources/js/index.js"></script>

</body>
</html>
